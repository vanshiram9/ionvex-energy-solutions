<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Warranty Check | Ionvex Energy Solutions</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Check lithium battery warranty status online using serial or QR code" />

  <!-- CSS -->
  <link rel="stylesheet" href="../css/main.css" />
  <link rel="stylesheet" href="../css/customer.css" />

  <link rel="icon" href="../assets/images/logo.png" />
</head>
<body>

<!-- ================= HEADER ================= -->
<header class="main-header">
  <div class="logo">
    <img src="../assets/images/logo.png" alt="Ionvex Energy Solutions" />
  </div>

  <nav class="nav-links">
    <a href="index.html">Home</a>
    <a href="products.html">Products</a>
    <a href="login.html">Login</a>
  </nav>
</header>

<!-- ================= WARRANTY CHECK ================= -->
<main class="warranty-container">

  <h1>Warranty Status Check</h1>
  <p>Enter Battery Serial Number or scan QR code</p>

  <div class="warranty-card">

    <input
      type="text"
      id="serialInput"
      placeholder="Enter Battery Serial Number"
    />

    <button id="checkBtn" class="btn-primary">
      Check Warranty
    </button>

    <div id="resultBox" class="result-box hidden"></div>

  </div>

</main>

<!-- ================= FOOTER ================= -->
<footer class="main-footer">
  <p>© 2026 Ionvex Energy Solutions</p>
</footer>

<!-- ================= HYBRID WARRANTY JS ================= -->
<script type="module">
  import { getFirestore, doc, getDoc } from
    "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  import { app } from "../js/firebase/app.js";

  const db = getFirestore(app);

  const serialInput = document.getElementById("serialInput");
  const checkBtn = document.getElementById("checkBtn");
  const resultBox = document.getElementById("resultBox");

  checkBtn.addEventListener("click", async () => {
    const serial = serialInput.value.trim();

    if (!serial) {
      showResult("Please enter serial number", "error");
      return;
    }

    try {
      const ref = doc(db, "batteries", serial);
      const snap = await getDoc(ref);

      if (!snap.exists()) {
        showResult("❌ Battery not found", "error");
        return;
      }

      const data = snap.data();

      const today = new Date();
      const expiry = data.warrantyExpiry.toDate();
      const status = expiry >= today ? "ACTIVE" : "EXPIRED";

      showResult(`
        <strong>Status:</strong> ${status}<br>
        <strong>Model:</strong> ${data.model}<br>
        <strong>Capacity:</strong> ${data.capacity} Ah<br>
        <strong>Vehicle:</strong> ${data.vehicleType}<br>
        <strong>Activated On:</strong> ${data.activatedOn.toDate().toDateString()}<br>
        <strong>Expiry Date:</strong> ${expiry.toDateString()}
      `, status === "ACTIVE" ? "success" : "warning");

    } catch (err) {
      showResult(err.message, "error");
    }
  });

  function showResult(html, type) {
    resultBox.className = `result-box ${type}`;
    resultBox.innerHTML = html;
    resultBox.classList.remove("hidden");
  }
</script>

</body>
</html>
